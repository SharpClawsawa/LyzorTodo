<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆ©çˆªçš„æ—¥ç¨‹çŠ¶æ€</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
            background:
                /* æš—è‰²è’™å±‚ */
                linear-gradient(rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.7)),
                /* èƒŒæ™¯å›¾ç‰‡ */
                url('./background.jpg') center/cover fixed;
            min-height: 100vh;
            color: white;
            overflow-x: hidden;
        }

        /* æ—¶é—´æ˜¾ç¤ºåŒºåŸŸ - å·¦å¯¹é½ */
        .time-section {
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 20px 10%;
        }

        .current-time {
            font-size: 14rem;
            font-weight: 300;
            margin-bottom: 10px;
            text-shadow: 0 2px 10px rgba(0, 0, 0, 0.5);
            letter-spacing: 2px;
            text-align: left;
        }

        .status-main {
            font-size: 3rem;
            font-weight: bold;
            margin: 20px 0;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
            text-align: left;
        }

        .status-detail {
            font-size: 1.8rem;
            opacity: 0.9;
            text-shadow: 0 2px 6px rgba(0, 0, 0, 0.5);
            text-align: left;
        }

        .progress-bar {
            width: 400px;
            height: 6px;
            background: rgba(255, 255, 255, 0.2);
            border-radius: 3px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b6b, #ee5a24);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        /* å‡†å¤‡çŠ¶æ€çš„è¿›åº¦æ¡é¢œè‰² */
        .progress-fill.prepare {
            background: linear-gradient(90deg, #ffd93d, #ff9a00);
        }

        /* è¯¾ç¨‹è¡¨åŒºåŸŸ - é€æ˜èƒŒæ™¯ */
        .schedule-section {
            background: rgba(0, 0, 0, 0.4);
            /* æ›´é€æ˜çš„èƒŒæ™¯ */
            backdrop-filter: blur(15px);
            padding: 60px 10% 40px;
            min-height: 100vh;
        }

        .section-title {
            font-size: 2.5rem;
            text-align: center;
            margin-bottom: 40px;
            color: white;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        /* è¯¾ç¨‹åˆ—è¡¨ - é€æ˜è®¾è®¡ */
        .courses-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .course-item {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
        }

        .course-item.current {
            background: linear-gradient(135deg, rgba(255, 107, 107, 0.3), rgba(238, 90, 36, 0.3));
            border-left: 4px solid #ff6b6b;
        }

        .course-item.future {
            background: rgba(255, 255, 255, 0.08);
        }

        .course-left {
            flex: 1;
        }

        .course-name {
            font-size: 1.8rem;
            font-weight: bold;
            margin-bottom: 8px;
        }

        .course-time {
            font-size: 1.4rem;
            opacity: 0.9;
        }

        .course-right {
            text-align: right;
            min-width: 200px;
        }

        .countdown {
            font-size: 1.6rem;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .time-status {
            font-size: 1.2rem;
            padding: 6px 12px;
            border-radius: 8px;
            background: rgba(255, 255, 255, 0.2);
        }

        .course-item.current .time-status {
            background: #ff6b6b;
            color: white;
        }

        /* çŠ¶æ€é¢œè‰² */
        .status-rest {
            color: #7bed9f;
        }

        .status-prepare {
            color: #ffa502;
        }

        .status-in-class {
            color: #ff6b6b;
        }

        /* æ»šåŠ¨æç¤º */
        .scroll-hint {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 1rem;
            opacity: 0.7;
            animation: bounce 2s infinite;
        }

        @keyframes bounce {

            0%,
            20%,
            50%,
            80%,
            100% {
                transform: translateX(-50%) translateY(0);
            }

            40% {
                transform: translateX(-50%) translateY(-10px);
            }

            60% {
                transform: translateX(-50%) translateY(-5px);
            }
        }

        .no-courses {
            text-align: center;
            padding: 60px;
            font-size: 1.4rem;
            opacity: 0.7;
        }

        /* é¡µé¢æ ‡é¢˜æ ·å¼ */
        .page-title {
            font-size: 4rem;
            text-align: left;
            margin-bottom: 30px;
            text-shadow: 0 2px 8px rgba(0, 0, 0, 0.5);
            color: white;
            letter-spacing: 1px;
        }

        /* ç§»åŠ¨ç«¯ä¼˜åŒ– */
        @media (max-width: 768px) {

            /* æ—¶é—´æ˜¾ç¤ºåŒºåŸŸä¼˜åŒ– */
            .time-section {
                padding: 20px 5%;
                justify-content: flex-start;
                padding-top: 20vh;
            }

            .current-time {
                font-size: 5rem;
                text-align: center;
                margin-bottom: 20px;
            }

            .current-time br {
                display: block;
                margin-top: 10px;
            }

            .current-time span {
                font-size: 1.2rem !important;
                display: block;
                margin-top: 5px;
            }

            .status-main {
                font-size: 1.8rem;
                text-align: center;
                margin: 15px 0;
            }

            .status-detail {
                font-size: 1.2rem;
                text-align: center;
            }

            .progress-bar {
                width: 100%;
                max-width: 300px;
                margin: 20px auto;
            }

            /* è¯¾ç¨‹è¡¨åŒºåŸŸä¼˜åŒ– */
            .schedule-section {
                padding: 40px 5% 20px;
            }

            .section-title {
                font-size: 1.8rem;
                margin-bottom: 30px;
            }

            /* è¯¾ç¨‹é¡¹ä¼˜åŒ– - æ”¹ä¸ºå‚ç›´å¸ƒå±€ */
            .course-item {
                flex-direction: column;
                align-items: flex-start;
                padding: 20px;
                gap: 15px;
            }

            .course-left {
                width: 100%;
            }

            .course-name {
                font-size: 1.4rem;
            }

            .course-time {
                font-size: 1.1rem;
            }

            .course-right {
                width: 100%;
                text-align: left;
                min-width: auto;
                display: flex;
                justify-content: space-between;
                align-items: center;
            }

            .countdown {
                font-size: 1.3rem;
                margin-bottom: 0;
            }

            .time-status {
                font-size: 1rem;
            }

            /* éšè—ç§»åŠ¨ç«¯ä¸éœ€è¦çš„å…ƒç´  */
            .scroll-hint {
                display: none;
            }

            /* è§¦æ‘¸å‹å¥½çš„äº¤äº’ */
            .course-item {
                cursor: pointer;
            }

            .course-item:active {
                transform: scale(0.98);
            }
        }

        /* å°å±æ‰‹æœºä¼˜åŒ– */
        @media (max-width: 480px) {
            .current-time {
                font-size: 4rem;
            }

            .status-main {
                font-size: 1.5rem;
            }

            .status-detail {
                font-size: 1rem;
            }

            .course-item {
                padding: 15px;
            }

            .course-name {
                font-size: 1.2rem;
            }

            .course-time {
                font-size: 1rem;
            }

            .countdown {
                font-size: 1.1rem;
            }

            .time-status {
                font-size: 0.9rem;
                padding: 4px 8px;
            }
        }

        /* æ¨ªå±æ¨¡å¼ä¼˜åŒ– */
        @media (max-height: 500px) and (orientation: landscape) {
            .time-section {
                padding-top: 10vh;
                height: auto;
                min-height: 100vh;
            }

            .current-time {
                font-size: 4rem;
            }

            .status-main {
                font-size: 1.5rem;
            }
        }
    </style>
</head>

<body>
    <!-- æ—¶é—´æ˜¾ç¤ºåŒºåŸŸ -->
    <div class="time-section">
        <div class="page-title">åˆ©çˆªç°åœ¨åœ¨åšä»€ä¹ˆï¼Ÿ</div>
        <div class="current-time" id="currentTime">--:--:--</div>
        <div class="status-main" id="statusMain">åŠ è½½ä¸­...</div>
        <div class="status-detail" id="statusDetail"></div>
        <div class="progress-bar">
            <div class="progress-fill" id="progressFill" style="width: 0%"></div>
        </div>
        <div class="scroll-hint">â†“ ä¸‹æ»‘æŸ¥çœ‹è¯¾ç¨‹è¡¨å–µ~ â†“</div>
    </div>

    <!-- è¯¾ç¨‹è¡¨åŒºåŸŸ -->
    <div class="schedule-section">
        <div class="section-title" id="weekTitle">ğŸ“… æœ¬å‘¨æ—¥ç¨‹ - ç¬¬<span id="weekNumber">1</span>å‘¨</div>
        <div class="courses-container" id="coursesContainer">
            <div class="no-courses">æ­£åœ¨åŠ è½½ä¸­~åˆ«æ€¥...</div>
        </div>
        <footer class="site-footer">
            <div class="footer-content">
        </footer>
    </div>

    <script>
        // å·¥å…·å‡½æ•°ï¼šè®¡ç®—å½“å‰æ˜¯ç¬¬å‡ å‘¨
        function getCurrentWeek(semesterStart) {
            const startDate = new Date(semesterStart);
            const now = new Date();
            const diffTime = now - startDate;
            const diffWeeks = Math.floor(diffTime / (1000 * 60 * 60 * 24 * 7)) + 1;
            return Math.max(1, diffWeeks);
        }

        // å·¥å…·å‡½æ•°ï¼šæ ¼å¼åŒ–æ—¶é—´
        function formatTime(date) {
            return date.toLocaleString('zh-CN', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });
        }

        // å·¥å…·å‡½æ•°ï¼šæ ¼å¼åŒ–æ—¥æœŸï¼ˆæœˆ/æ—¥ï¼‰
        function formatDate(date) {
            return (date.getMonth() + 1) + '/' + date.getDate();
        }

        // å·¥å…·å‡½æ•°ï¼šè·å–è¯¾ç¨‹å…·ä½“æ—¥æœŸ
        function getCourseDate(dayOfWeek, weekStartDate) {
            const courseDate = new Date(weekStartDate);
            courseDate.setDate(weekStartDate.getDate() + (dayOfWeek - 1));
            return courseDate;
        }

        // å·¥å…·å‡½æ•°ï¼šæ—¶é—´å­—ç¬¦ä¸²è½¬åˆ†é’Ÿæ•°
        function timeToMinutes(timeStr) {
            const [hours, minutes] = timeStr.split(':').map(Number);
            return hours * 60 + minutes;
        }

        // å·¥å…·å‡½æ•°ï¼šåˆ†é’Ÿæ•°è½¬æ—¶é—´å­—ç¬¦ä¸²ï¼ˆxxå°æ—¶xxåˆ†é’Ÿåï¼‰
        function minutesToTimeString(totalMinutes) {
            const hours = Math.floor(totalMinutes / 60);
            const minutes = totalMinutes % 60;

            if (hours > 0 && minutes > 0) {
                return `${hours}å°æ—¶${minutes}åˆ†é’Ÿåå¼€å§‹`;
            } else if (hours > 0) {
                return `${hours}å°æ—¶åå¼€å§‹`;
            } else {
                return `${minutes}åˆ†é’Ÿåå¼€å§‹`;
            }
        }

        // æ£€æŸ¥å½“å‰è¯¾ç¨‹çŠ¶æ€
        function checkCurrentStatus(courses, currentWeek, currentTime) {
            const currentDay = currentTime.getDay() || 7;
            const currentMinutes = currentTime.getHours() * 60 + currentTime.getMinutes();

            let currentCourse = null;
            let nextCourse = null;

            for (const course of courses) {
                if (course.dayOfWeek === currentDay && course.weeks.includes(currentWeek)) {
                    const startMinutes = timeToMinutes(course.startTime);
                    const endMinutes = timeToMinutes(course.endTime);

                    // å½“å‰æ­£åœ¨ä¸Šçš„è¯¾ç¨‹
                    if (currentMinutes >= startMinutes && currentMinutes <= endMinutes) {
                        currentCourse = {
                            ...course,
                            progress: ((currentMinutes - startMinutes) / (endMinutes - startMinutes)) * 100,
                            minutesPassed: currentMinutes - startMinutes,
                            totalMinutes: endMinutes - startMinutes
                        };
                        break;
                    }

                    // ä¸‹ä¸€ä¸ªè¯¾ç¨‹ï¼ˆ60åˆ†é’Ÿå†…å¼€å§‹çš„ï¼‰
                    if (currentMinutes < startMinutes && startMinutes - currentMinutes <= 60) {
                        if (!nextCourse || startMinutes < timeToMinutes(nextCourse.startTime)) {
                            nextCourse = {
                                ...course,
                                minutesUntil: startMinutes - currentMinutes
                            };
                        }
                    }
                }
            }

            return { currentCourse, nextCourse };
        }

        function updateStatusDisplay(currentCourse, nextCourse, currentTime) {
            const currentTimeElement = document.getElementById('currentTime');
            const statusMainElement = document.getElementById('statusMain');
            const statusDetailElement = document.getElementById('statusDetail');
            const progressFillElement = document.getElementById('progressFill');

            // 1. æ›´æ–°æ—¥æœŸå’Œæ—¶é—´æ˜¾ç¤º
            const dateString = currentTime.toLocaleDateString('zh-CN', {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                weekday: 'long'
            });

            const timeOnly = currentTime.toLocaleTimeString('zh-CN', {
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit'
            });

            // ç§»åŠ¨ç«¯æ£€æµ‹
            const isMobile = window.innerWidth <= 768;

            if (isMobile) {
                // ç§»åŠ¨ç«¯æ˜¾ç¤ºï¼šæ—¶é—´åœ¨ä¸Šï¼Œæ—¥æœŸåœ¨ä¸‹
                currentTimeElement.innerHTML = `${timeOnly}<br><span>${dateString}</span>`;
            } else {
                // PCç«¯ä¿æŒåŸæœ‰æ˜¾ç¤º
                currentTimeElement.innerHTML = `${timeOnly}<br><span style="font-size: 2rem; opacity: 0.8;">${dateString}</span>`;
            }

            // 2. æ›´æ–°é¡µé¢æ ‡é¢˜
            const titleTime = currentTime.toLocaleTimeString('zh-CN', {
                hour: '2-digit',
                minute: '2-digit'
            });

            let titleStatus;
            if (currentCourse) {
                titleStatus = `åˆ©çˆªæ­£åœ¨è¿›è¡Œ${currentCourse.name}`;
                statusMainElement.textContent = `ã€è¿›è¡Œä¸­ã€‘${currentCourse.name}`;
                statusMainElement.className = 'status-main status-in-class';

                const progressPercent = Math.min(100, Math.max(0, currentCourse.progress));
                statusDetailElement.textContent =
                    `${currentCourse.startTime}-${currentCourse.endTime}ï¼ˆå·²è¿›è¡Œ ${currentCourse.minutesPassed}/${currentCourse.totalMinutes} åˆ†é’Ÿï¼‰`;

                progressFillElement.style.width = `${progressPercent}%`;
                progressFillElement.className = 'progress-fill';

            } else if (nextCourse && nextCourse.minutesUntil <= 60) {
                titleStatus = `åˆ©çˆªæ­£åœ¨å‡†å¤‡${nextCourse.name}`;
                statusMainElement.textContent = `ã€å‡†å¤‡ä¸­ã€‘${nextCourse.name}`;
                statusMainElement.className = 'status-main status-prepare';

                const timeString = minutesToTimeString(nextCourse.minutesUntil);
                statusDetailElement.textContent =
                    `${nextCourse.startTime}-${nextCourse.endTime}ï¼ˆ${timeString}ï¼‰`;

                // å‡†å¤‡çŠ¶æ€çš„å€’è®¡æ—¶è¿›åº¦æ¡ï¼šä»100%åˆ°0%
                const prepareProgressPercent = Math.max(0, Math.min(100, (nextCourse.minutesUntil / 60) * 100));
                progressFillElement.style.width = `${prepareProgressPercent}%`;
                progressFillElement.className = 'progress-fill prepare';

            } else {
                titleStatus = 'åˆ©çˆªæ­£åœ¨ä¼‘æ¯ä¸­~';
                statusMainElement.textContent = 'ã€ä¼‘æ¯ä¸­ã€‘';
                statusMainElement.className = 'status-main status-rest';
                statusDetailElement.textContent = '';
                progressFillElement.style.width = '0%';
                progressFillElement.className = 'progress-fill';
            }

            document.title = `${titleTime} | ${titleStatus}`;
        }

        // ç”Ÿæˆè¯¾ç¨‹åˆ—è¡¨ï¼ˆä¸åˆ†ç»„ï¼ŒæŒ‰æ—¶é—´é¡ºåºï¼‰
        function generateCourseList(courses, currentWeek, currentTime) {
            const container = document.getElementById('coursesContainer');
            const { start: weekStart } = getWeekDateRange();
            const currentDay = currentTime.getDay() || 7;
            const currentMinutes = currentTime.getHours() * 60 + currentTime.getMinutes();

            // æ”¶é›†æ‰€æœ‰æœªæ¥è¯¾ç¨‹ï¼ˆåŒ…æ‹¬ä»Šå¤©æœªå¼€å§‹çš„ï¼‰
            let futureCourses = [];

            for (let day = currentDay; day <= 7; day++) {
                const dayCourses = courses.filter(course =>
                    course.dayOfWeek === day && course.weeks.includes(currentWeek)
                ).sort((a, b) => timeToMinutes(a.startTime) - timeToMinutes(b.startTime));

                for (const course of dayCourses) {
                    const courseDate = getCourseDate(day, weekStart);
                    const startMinutes = timeToMinutes(course.startTime);
                    const endMinutes = timeToMinutes(course.endTime);

                    // å¦‚æœæ˜¯ä»Šå¤©ï¼Œæ£€æŸ¥æ˜¯å¦å·²ç»“æŸ
                    if (day === currentDay && currentMinutes > endMinutes) {
                        continue; // è·³è¿‡å·²ç»“æŸçš„è¯¾ç¨‹
                    }

                    futureCourses.push({
                        ...course,
                        date: courseDate,
                        dayOfWeek: day,
                        startMinutes,
                        endMinutes
                    });
                }
            }

            // æŒ‰æ—¶é—´æ’åº
            futureCourses.sort((a, b) => {
                if (a.dayOfWeek !== b.dayOfWeek) return a.dayOfWeek - b.dayOfWeek;
                return a.startMinutes - b.startMinutes;
            });

            if (futureCourses.length === 0) {
                container.innerHTML = '<div class="no-courses">æœ¬å‘¨å·²ç»æ²¡æœ‰æ—¥ç¨‹å®‰æ’å•¦~ä¼‘æ¯awa~</div>';
                return;
            }

            let coursesHTML = '';

            futureCourses.forEach(course => {
                const isCurrent = (course.dayOfWeek === currentDay &&
                    currentMinutes >= course.startMinutes &&
                    currentMinutes <= course.endMinutes);

                const isToday = course.dayOfWeek === currentDay;

                let countdownText = '';
                let statusText = '';

                if (isCurrent) {
                    // å½“å‰è¯¾ç¨‹
                    const minutesPassed = currentMinutes - course.startMinutes;
                    const totalMinutes = course.endMinutes - course.startMinutes;
                    countdownText = `å·²è¿›è¡Œ ${minutesPassed}/${totalMinutes} åˆ†é’Ÿ`;
                    statusText = 'è¿›è¡Œä¸­';
                } else {
                    // æœªæ¥è¯¾ç¨‹
                    let minutesUntil = 0;
                    if (isToday) {
                        // ä»Šå¤©æœªæ¥çš„è¯¾ç¨‹
                        minutesUntil = course.startMinutes - currentMinutes;
                    } else {
                        // æœªæ¥æ—¥æœŸçš„è¯¾ç¨‹
                        const daysUntil = course.dayOfWeek - currentDay;
                        minutesUntil = (daysUntil * 24 * 60) + course.startMinutes - currentMinutes;
                    }

                    countdownText = minutesToTimeString(minutesUntil);
                    statusText = '';
                }

                coursesHTML += `
                    <div class="course-item ${isCurrent ? 'current' : 'future'}">
                        <div class="course-left">
                            <div class="course-name">${course.name}</div>
                            <div class="course-time">${formatDate(course.date)} ${course.startTime}-${course.endTime}</div>
                        </div>
                        <div class="course-right">
                            <div class="countdown">${countdownText}</div>
                            <div class="time-status">${statusText}</div>
                        </div>
                    </div>
                `;
            });

            container.innerHTML = coursesHTML;
        }

        // å·¥å…·å‡½æ•°ï¼šè·å–æœ¬å‘¨çš„æ—¥æœŸèŒƒå›´
        function getWeekDateRange() {
            const now = new Date();
            const currentDay = now.getDay();
            const startOfWeek = new Date(now);
            startOfWeek.setDate(now.getDate() - currentDay + (currentDay === 0 ? -6 : 1));
            const endOfWeek = new Date(startOfWeek);
            endOfWeek.setDate(startOfWeek.getDate() + 6);

            return { start: startOfWeek, end: endOfWeek };
        }

        // ä¸»å‡½æ•°
        async function main() {
            try {
                // åŠ è½½è¯¾ç¨‹æ•°æ®
                const response = await fetch('./schedule.json');
                const schedule = await response.json();

                // è®¡ç®—å½“å‰å‘¨æ¬¡
                const currentWeek = getCurrentWeek(schedule.semesterStart);

                function updateAll() {
                    const now = new Date();

                    // è®¡ç®—å½“å‰å‘¨æ¬¡
                    const currentWeek = getCurrentWeek(schedule.semesterStart);

                    // æ›´æ–°å‘¨æ•°æ˜¾ç¤º
                    document.getElementById('weekNumber').textContent = currentWeek;

                    // æ£€æŸ¥å½“å‰çŠ¶æ€
                    const { currentCourse, nextCourse } = checkCurrentStatus(schedule.courses, currentWeek, now);

                    // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
                    updateStatusDisplay(currentCourse, nextCourse, now);

                    // æ›´æ–°è¯¾ç¨‹åˆ—è¡¨
                    generateCourseList(schedule.courses, currentWeek, now);
                }

                // åˆå§‹æ›´æ–°
                updateAll();

                // æ¯ç§’æ›´æ–°ä¸€æ¬¡
                setInterval(updateAll, 1000);

            } catch (error) {
                console.error('åŠ è½½è¯¾ç¨‹æ•°æ®å¤±è´¥:', error);
                document.getElementById('statusMain').textContent = 'åŠ è½½è¯¾ç¨‹è¡¨å¤±è´¥æƒ¹~';
                document.getElementById('statusDetail').textContent = 'æ˜¯ä¸æ˜¯æ—¥ç¨‹æ–‡ä»¶åˆç‚¸äº†ï¼Œæˆ–è€…æ˜¯ç›´æ¥åœ¨æœ¬åœ°è¿è¡Œäº†å‘€~';
                document.getElementById('coursesContainer').innerHTML =
                    '<div class="no-courses">æ—¥ç¨‹ä¸ºç©ºqwq</div>';
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆåå¯åŠ¨
        document.addEventListener('DOMContentLoaded', main);
    </script>
</body>

</html>